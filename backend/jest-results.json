{"numFailedTestSuites":1,"numFailedTests":9,"numPassedTestSuites":2,"numPassedTests":38,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":3,"numTotalTests":47,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1765391529932,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["Authentication Controller - Unit Tests","registerUser"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests registerUser ✅ [Happy Path] Register user thành công","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Register user thành công"},{"ancestorTitles":["Authentication Controller - Unit Tests","registerUser"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests registerUser ❌ [Validation] Register thiếu email","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"❌ [Validation] Register thiếu email"},{"ancestorTitles":["Authentication Controller - Unit Tests","loginUser"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests loginUser ✅ [Happy Path] Login thành công","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Login thành công"},{"ancestorTitles":["Authentication Controller - Unit Tests","refreshToken"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests refreshToken ✅ [Happy Path] Refresh token thành công","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Refresh token thành công"},{"ancestorTitles":["Authentication Controller - Unit Tests","refreshToken"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests refreshToken ❌ [Edge Case] User không tồn tại","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"❌ [Edge Case] User không tồn tại"},{"ancestorTitles":["Authentication Controller - Unit Tests","refreshToken"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests refreshToken ❌ [Security] Token Reuse Detected","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"❌ [Security] Token Reuse Detected"},{"ancestorTitles":["Authentication Controller - Unit Tests","Token Security Properties"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests Token Security Properties ✅ Access token có exp claim","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"✅ Access token có exp claim"},{"ancestorTitles":["Authentication Controller - Unit Tests","Token Security Properties"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests Token Security Properties ✅ Refresh token là random bytes, không JWT","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"✅ Refresh token là random bytes, không JWT"}],"endTime":1765391531043,"message":"","name":"/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.unit.test.js","startTime":1765391530059,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Authentication Controller - Unit Tests","registerUser"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests registerUser ✅ [Happy Path] Register user thành công","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Register user thành công"},{"ancestorTitles":["Authentication Controller - Unit Tests","registerUser"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests registerUser ❌ [Validation] Register thiếu email","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"❌ [Validation] Register thiếu email"},{"ancestorTitles":["Authentication Controller - Unit Tests","loginUser"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests loginUser ✅ [Happy Path] Login thành công","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Login thành công"},{"ancestorTitles":["Authentication Controller - Unit Tests","refreshToken"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests refreshToken ✅ [Happy Path] Refresh token thành công","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Refresh token thành công"},{"ancestorTitles":["Authentication Controller - Unit Tests","refreshToken"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests refreshToken ❌ [Edge Case] User không tồn tại","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"❌ [Edge Case] User không tồn tại"},{"ancestorTitles":["Authentication Controller - Unit Tests","refreshToken"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests refreshToken ❌ [Security] Token Reuse Detected","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"❌ [Security] Token Reuse Detected"},{"ancestorTitles":["Authentication Controller - Unit Tests","Token Security Properties"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests Token Security Properties ✅ Access token có exp claim","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"✅ Access token có exp claim"},{"ancestorTitles":["Authentication Controller - Unit Tests","Token Security Properties"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Authentication Controller - Unit Tests Token Security Properties ✅ Refresh token là random bytes, không JWT","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"✅ Refresh token là random bytes, không JWT"}],"endTime":1765391531075,"message":"","name":"/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.security.test.js","startTime":1765391530060,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.1 Register User"],"duration":171,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.1 Register User ✅ [Happy Path] Register với email & password hợp lệ","invocations":1,"location":null,"numPassingAsserts":8,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Register với email & password hợp lệ"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.1 Register User"],"duration":74,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.1 Register User ❌ [Edge Case] Register với email đã tồn tại","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Edge Case] Register với email đã tồn tại"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.1 Register User"],"duration":13,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.1 Register User ❌ [Validation] Register thiếu email","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Validation] Register thiếu email"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.1 Register User"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.1 Register User ❌ [Validation] Register thiếu password","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Validation] Register thiếu password"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.1 Register User"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.1 Register User ❌ [Validation] Register với password quá ngắn","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Validation] Register với password quá ngắn"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.1 Register User"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.1 Register User ❌ [Validation] Register với email format sai","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"❌ [Validation] Register với email format sai"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.2 Login User"],"duration":129,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.2 Login User ✅ [Happy Path] Login với email & password đúng","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Login với email & password đúng"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.2 Login User"],"duration":125,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.2 Login User ❌ [Security] Login với password sai","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Security] Login với password sai"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.2 Login User"],"duration":110,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.2 Login User ❌ [Security] Login với email không tồn tại","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Security] Login với email không tồn tại"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.2 Login User"],"duration":101,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.2 Login User ❌ [Validation] Login thiếu email","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"❌ [Validation] Login thiếu email"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.2 Login User"],"duration":92,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.2 Login User ❌ [Validation] Login thiếu password","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"❌ [Validation] Login thiếu password"},{"ancestorTitles":["1. AUTH FLOW - Login & Register","1.2 Login User"],"duration":183,"failureDetails":[],"failureMessages":[],"fullName":"1. AUTH FLOW - Login & Register 1.2 Login User ✅ [Security] Login hủy hết refresh token cũ","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"✅ [Security] Login hủy hết refresh token cũ"},{"ancestorTitles":["2. TOKEN REFRESHING - Token Rotation & Reuse Detection","2.1 Happy Path - Token Refresh"],"duration":134,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\nExpected path: \u001b[32m\"accessToken\"\u001b[39m\nReceived path: \u001b[31m[]\u001b[39m\n\nReceived value: \u001b[31m{\"data\": {\"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OTM5YmNhY2ExZTE1ZjNhNjM0ZWIzNDAiLCJqdGkiOiJhMWUwMjg1MS1jOGMzLTRmMWYtODc0OC1jM2EyZDkwM2U5MzMiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NTM5MTUzMiwiZXhwIjoxNzY1MzkyNDMyfQ._M8ctLtaEuAFDmptsnXRkEL5suTU2JnIHWwHtHap-tA\", \"refreshToken\": \"c62b0ec0e89ab9c2cc812f8f8c042d816009513898521115b2dd1d3d9b087e9252e67c91c29c5165eb64b0496b10b2ee2fe1eb81d6340cfa49a7bf2c2753c262\"}, \"message\": \"Token refreshed successfully\", \"success\": true}\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\nExpected path: \u001b[32m\"accessToken\"\u001b[39m\nReceived path: \u001b[31m[]\u001b[39m\n\nReceived value: \u001b[31m{\"data\": {\"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OTM5YmNhY2ExZTE1ZjNhNjM0ZWIzNDAiLCJqdGkiOiJhMWUwMjg1MS1jOGMzLTRmMWYtODc0OC1jM2EyZDkwM2U5MzMiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NTM5MTUzMiwiZXhwIjoxNzY1MzkyNDMyfQ._M8ctLtaEuAFDmptsnXRkEL5suTU2JnIHWwHtHap-tA\", \"refreshToken\": \"c62b0ec0e89ab9c2cc812f8f8c042d816009513898521115b2dd1d3d9b087e9252e67c91c29c5165eb64b0496b10b2ee2fe1eb81d6340cfa49a7bf2c2753c262\"}, \"message\": \"Token refreshed successfully\", \"success\": true}\u001b[39m\n    at Object.toHaveProperty (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:344:31)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"2. TOKEN REFRESHING - Token Rotation & Reuse Detection 2.1 Happy Path - Token Refresh ✅ [Happy Path] Refresh với token hợp lệ","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"✅ [Happy Path] Refresh với token hợp lệ"},{"ancestorTitles":["2. TOKEN REFRESHING - Token Rotation & Reuse Detection","2.2 Reuse Detection - Security Critical ⚠️"],"duration":188,"failureDetails":[{"matcherResult":{"actual":"Refresh token is invalid","expected":"Invalid refresh token","message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:372:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"2. TOKEN REFRESHING - Token Rotation & Reuse Detection 2.2 Reuse Detection - Security Critical ⚠️ ✅ [CRITICAL] Reuse Detection: Gửi token đã sử dụng","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"failed","title":"✅ [CRITICAL] Reuse Detection: Gửi token đã sử dụng"},{"ancestorTitles":["2. TOKEN REFRESHING - Token Rotation & Reuse Detection","2.2 Reuse Detection - Security Critical ⚠️"],"duration":145,"failureDetails":[],"failureMessages":[],"fullName":"2. TOKEN REFRESHING - Token Rotation & Reuse Detection 2.2 Reuse Detection - Security Critical ⚠️ ✅ [CRITICAL] Reuse Detection: Hủy tất cả token sau phát hiện reuse","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"✅ [CRITICAL] Reuse Detection: Hủy tất cả token sau phát hiện reuse"},{"ancestorTitles":["2. TOKEN REFRESHING - Token Rotation & Reuse Detection","2.3 Expired Token"],"duration":113,"failureDetails":[{"matcherResult":{"actual":"Refresh token is invalid","expected":"Invalid refresh token","message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:426:43)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"2. TOKEN REFRESHING - Token Rotation & Reuse Detection 2.3 Expired Token ❌ [Edge Case] Gửi refresh token đã hết hạn","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"❌ [Edge Case] Gửi refresh token đã hết hạn"},{"ancestorTitles":["2. TOKEN REFRESHING - Token Rotation & Reuse Detection","2.4 Invalid Token Format"],"duration":127,"failureDetails":[{"matcherResult":{"actual":"Refresh token is invalid","expected":"Invalid refresh token","message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:439:43)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"2. TOKEN REFRESHING - Token Rotation & Reuse Detection 2.4 Invalid Token Format ❌ [Security] Gửi refresh token giả mạo","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"❌ [Security] Gửi refresh token giả mạo"},{"ancestorTitles":["2. TOKEN REFRESHING - Token Rotation & Reuse Detection","2.4 Invalid Token Format"],"duration":118,"failureDetails":[{"matcherResult":{"actual":401,"expected":400,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m400\u001b[39m\nReceived: \u001b[31m401\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m400\u001b[39m\nReceived: \u001b[31m401\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:446:37)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"2. TOKEN REFRESHING - Token Rotation & Reuse Detection 2.4 Invalid Token Format ❌ [Validation] Không gửi refresh token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"❌ [Validation] Không gửi refresh token"},{"ancestorTitles":["3. PROTECTED ROUTES - Access Token Validation","3.1 Valid Access Token"],"duration":145,"failureDetails":[],"failureMessages":[],"fullName":"3. PROTECTED ROUTES - Access Token Validation 3.1 Valid Access Token ✅ [Happy Path] Gửi access token hợp lệ","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Gửi access token hợp lệ"},{"ancestorTitles":["3. PROTECTED ROUTES - Access Token Validation","3.2 Invalid Access Token"],"duration":119,"failureDetails":[{"matcherResult":{"actual":401,"expected":403,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m403\u001b[39m\nReceived: \u001b[31m401\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m403\u001b[39m\nReceived: \u001b[31m401\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:498:31)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"3. PROTECTED ROUTES - Access Token Validation 3.2 Invalid Access Token ❌ [Security] Gửi access token giả mạo","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"❌ [Security] Gửi access token giả mạo"},{"ancestorTitles":["3. PROTECTED ROUTES - Access Token Validation","3.2 Invalid Access Token"],"duration":122,"failureDetails":[{"matcherResult":{"actual":"Authorization header is required","expected":"Token not provided","message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mToken not provid\u001b[27med\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mAuthorization header is requir\u001b[27med\"\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mToken not provid\u001b[27med\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7mAuthorization header is requir\u001b[27med\"\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:509:37)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"3. PROTECTED ROUTES - Access Token Validation 3.2 Invalid Access Token ❌ [Validation] Không gửi token trong header","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"❌ [Validation] Không gửi token trong header"},{"ancestorTitles":["3. PROTECTED ROUTES - Access Token Validation","3.2 Invalid Access Token"],"duration":135,"failureDetails":[],"failureMessages":[],"fullName":"3. PROTECTED ROUTES - Access Token Validation 3.2 Invalid Access Token ❌ [Validation] Header Authorization format sai","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"❌ [Validation] Header Authorization format sai"},{"ancestorTitles":["3. PROTECTED ROUTES - Access Token Validation","3.3 Expired Access Token"],"duration":122,"failureDetails":[{"matcherResult":{"actual":401,"expected":403,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m403\u001b[39m\nReceived: \u001b[31m401\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m403\u001b[39m\nReceived: \u001b[31m401\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:539:31)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"3. PROTECTED ROUTES - Access Token Validation 3.3 Expired Access Token ❌ [Edge Case] Gửi access token đã hết hạn","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"❌ [Edge Case] Gửi access token đã hết hạn"},{"ancestorTitles":["3. PROTECTED ROUTES - Access Token Validation","3.4 User Not Found"],"duration":123,"failureDetails":[],"failureMessages":[],"fullName":"3. PROTECTED ROUTES - Access Token Validation 3.4 User Not Found ❌ [Edge Case] User bị xóa nhưng token vẫn hợp lệ","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Edge Case] User bị xóa nhưng token vẫn hợp lệ"},{"ancestorTitles":["4. LOGOUT - Token Revocation","4.1 Logout Success"],"duration":131,"failureDetails":[],"failureMessages":[],"fullName":"4. LOGOUT - Token Revocation 4.1 Logout Success ✅ [Happy Path] Logout xóa refresh token","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"✅ [Happy Path] Logout xóa refresh token"},{"ancestorTitles":["4. LOGOUT - Token Revocation","4.1 Logout Success"],"duration":129,"failureDetails":[],"failureMessages":[],"fullName":"4. LOGOUT - Token Revocation 4.1 Logout Success ✅ [Security] Sau logout, refresh token không dùng được","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"✅ [Security] Sau logout, refresh token không dùng được"},{"ancestorTitles":["4. LOGOUT - Token Revocation","4.2 Logout Validation"],"duration":131,"failureDetails":[],"failureMessages":[],"fullName":"4. LOGOUT - Token Revocation 4.2 Logout Validation ❌ [Validation] Logout không gửi token","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"❌ [Validation] Logout không gửi token"},{"ancestorTitles":["4. LOGOUT - Token Revocation","4.2 Logout Validation"],"duration":131,"failureDetails":[],"failureMessages":[],"fullName":"4. LOGOUT - Token Revocation 4.2 Logout Validation ✅ [Idempotent] Logout 2 lần với token giống nhau","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"✅ [Idempotent] Logout 2 lần với token giống nhau"},{"ancestorTitles":["5. EDGE CASES & INTEGRATION TESTS"],"duration":87,"failureDetails":[{"matcherResult":{"actual":401,"expected":200,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m200\u001b[39m\nReceived: \u001b[31m401\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m200\u001b[39m\nReceived: \u001b[31m401\u001b[39m\n    at Object.toBe (/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js:701:34)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"5. EDGE CASES & INTEGRATION TESTS ✅ Toàn bộ flow: Register -> Login -> Refresh -> Protected -> Logout","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"failed","title":"✅ Toàn bộ flow: Register -> Login -> Refresh -> Protected -> Logout"},{"ancestorTitles":["5. EDGE CASES & INTEGRATION TESTS"],"duration":135,"failureDetails":[],"failureMessages":[],"fullName":"5. EDGE CASES & INTEGRATION TESTS ✅ Multiple users isolation","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"✅ Multiple users isolation"},{"ancestorTitles":["5. EDGE CASES & INTEGRATION TESTS"],"duration":67,"failureDetails":[],"failureMessages":[],"fullName":"5. EDGE CASES & INTEGRATION TESTS ❌ Token timing attack mitigation","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"❌ Token timing attack mitigation"}],"endTime":1765391534556,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m2. TOKEN REFRESHING - Token Rotation & Reuse Detection › 2.1 Happy Path - Token Refresh › ✅ [Happy Path] Refresh với token hợp lệ\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected path: \u001b[32m\"accessToken\"\u001b[39m\n    Received path: \u001b[31m[]\u001b[39m\n\n    Received value: \u001b[31m{\"data\": {\"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OTM5YmNhY2ExZTE1ZjNhNjM0ZWIzNDAiLCJqdGkiOiJhMWUwMjg1MS1jOGMzLTRmMWYtODc0OC1jM2EyZDkwM2U5MzMiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NTM5MTUzMiwiZXhwIjoxNzY1MzkyNDMyfQ._M8ctLtaEuAFDmptsnXRkEL5suTU2JnIHWwHtHap-tA\", \"refreshToken\": \"c62b0ec0e89ab9c2cc812f8f8c042d816009513898521115b2dd1d3d9b087e9252e67c91c29c5165eb64b0496b10b2ee2fe1eb81d6340cfa49a7bf2c2753c262\"}, \"message\": \"Token refreshed successfully\", \"success\": true}\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 342 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 343 |\u001b[39m         expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 344 |\u001b[39m         expect(response\u001b[33m.\u001b[39mbody)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'accessToken'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 345 |\u001b[39m         expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39maccessToken)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoBe(validAccessToken)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 346 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 347 |\u001b[39m         \u001b[90m// Verify token mới hợp lệ\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toHaveProperty (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:344:31)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m2. TOKEN REFRESHING - Token Rotation & Reuse Detection › 2.2 Reuse Detection - Security Critical ⚠️ › ✅ [CRITICAL] Reuse Detection: Gửi token đã sử dụng\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\n    Received: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 370 |\u001b[39m         expect(response2\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 371 |\u001b[39m         expect(response2\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 372 |\u001b[39m         expect(response2\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Invalid refresh token'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 373 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 374 |\u001b[39m         \u001b[90m// ⚠️ CRITICAL: Verify tất cả token của user bị xóa (logout từ tất cả devices)\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 375 |\u001b[39m         \u001b[36mconst\u001b[39m remainingTokens \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mRefreshToken\u001b[39m\u001b[33m.\u001b[39mfind({ userId\u001b[33m:\u001b[39m testUser\u001b[33m.\u001b[39m_id })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:372:40)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m2. TOKEN REFRESHING - Token Rotation & Reuse Detection › 2.3 Expired Token › ❌ [Edge Case] Gửi refresh token đã hết hạn\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\n    Received: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 424 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 425 |\u001b[39m             expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 426 |\u001b[39m             expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Invalid refresh token'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 427 |\u001b[39m             })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 428 |\u001b[39m         })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 429 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:426:43)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m2. TOKEN REFRESHING - Token Rotation & Reuse Detection › 2.4 Invalid Token Format › ❌ [Security] Gửi refresh token giả mạo\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"\u001b[7mInvalid r\u001b[27mefresh token\"\u001b[39m\n    Received: \u001b[31m\"\u001b[7mR\u001b[27mefresh token\u001b[7m is invalid\u001b[27m\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 437 |\u001b[39m             expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 438 |\u001b[39m             expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 439 |\u001b[39m             expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Invalid refresh token'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 440 |\u001b[39m             })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 441 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 442 |\u001b[39m             test(\u001b[32m'❌ [Validation] Không gửi refresh token'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:439:43)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m2. TOKEN REFRESHING - Token Rotation & Reuse Detection › 2.4 Invalid Token Format › ❌ [Validation] Không gửi refresh token\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m400\u001b[39m\n    Received: \u001b[31m401\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 444 |\u001b[39m                 \u001b[33m.\u001b[39mpost(\u001b[32m'/auth/refresh-token'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 445 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 446 |\u001b[39m             expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 447 |\u001b[39m             expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 448 |\u001b[39m             expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Refresh token is required'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 449 |\u001b[39m         })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:446:37)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m3. PROTECTED ROUTES - Access Token Validation › 3.2 Invalid Access Token › ❌ [Security] Gửi access token giả mạo\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m403\u001b[39m\n    Received: \u001b[31m401\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 496 |\u001b[39m         \u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Bearer invalid.token.here'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 497 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 498 |\u001b[39m       expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 499 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 500 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Invalid token'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 501 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:498:31)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m3. PROTECTED ROUTES - Access Token Validation › 3.2 Invalid Access Token › ❌ [Validation] Không gửi token trong header\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"\u001b[7mToken not provid\u001b[27med\"\u001b[39m\n    Received: \u001b[31m\"\u001b[7mAuthorization header is requir\u001b[27med\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 507 |\u001b[39m       expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 508 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 509 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Token not provided'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 510 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 511 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 512 |\u001b[39m     test(\u001b[32m'❌ [Validation] Header Authorization format sai'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:509:37)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m3. PROTECTED ROUTES - Access Token Validation › 3.3 Expired Access Token › ❌ [Edge Case] Gửi access token đã hết hạn\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m403\u001b[39m\n    Received: \u001b[31m401\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 537 |\u001b[39m         \u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer ${expiredToken}`\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 538 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 539 |\u001b[39m       expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 540 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 541 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'Invalid token'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 542 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:539:31)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1m5. EDGE CASES & INTEGRATION TESTS › ✅ Toàn bộ flow: Register -> Login -> Refresh -> Protected -> Logout\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m200\u001b[39m\n    Received: \u001b[31m401\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 699 |\u001b[39m       \u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer ${accessToken2}`\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 700 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 701 |\u001b[39m     expect(protectedRes2\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 702 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 703 |\u001b[39m     \u001b[90m// Step 5: Logout\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 704 |\u001b[39m     \u001b[90m// Note: Cần lấy token mới từ refresh response\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/auth.integration.test.js\u001b[39m\u001b[0m\u001b[2m:701:34)\u001b[22m\u001b[2m\u001b[22m\n","name":"/home/dell/Documents/js/nodejs2api/nodejs-2/backend/src/__tests__/auth.integration.test.js","startTime":1765391530060,"status":"failed","summary":""}],"wasInterrupted":false}
